<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Garcia Builder</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/global.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
            color: #fff;
            min-height: 100vh;
        }

        .dashboard-container {
            padding-top: 120px;
            min-height: 100vh;
        }

        .dashboard-header {
            background: linear-gradient(135deg, rgba(246, 200, 78, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(246, 200, 78, 0.2);
        }

        .stats-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            height: 100%;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .stats-card:hover {
            transform: translateY(-5px);
            border-color: rgba(246, 200, 78, 0.3);
            box-shadow: 0 8px 25px rgba(246, 200, 78, 0.2);
        }

        .main-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            backdrop-filter: blur(10px);
            margin-bottom: 2rem;
        }

        .profile-card {
            background: linear-gradient(135deg, rgba(246, 200, 78, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
            border: 1px solid rgba(246, 200, 78, 0.3);
            border-radius: 20px;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }

        .avatar-section {
            text-align: center;
            margin-bottom: 2rem;
        }

        .avatar-container {
            position: relative;
            display: inline-block;
        }

        .main-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid #F6C84E;
            object-fit: cover;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .main-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(246, 200, 78, 0.4);
        }

        .avatar-edit-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: #F6C84E;
            color: #000;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .avatar-edit-btn:hover {
            background: #f4b942;
            transform: scale(1.1);
        }

        .info-row {
            display: flex;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-icon {
            width: 40px;
            text-align: center;
            color: #F6C84E;
        }

        .info-label {
            font-weight: 500;
            color: rgba(255, 255, 255, 0.7);
            min-width: 100px;
        }

        .info-value {
            color: #fff;
            font-weight: 500;
        }

        .btn-primary {
            background: linear-gradient(135deg, #F6C84E 0%, #f4b942 100%);
            border: none;
            color: #000;
            font-weight: 600;
            border-radius: 10px;
            padding: 0.75rem 1.5rem;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #f4b942 0%, #F6C84E 100%);
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(246, 200, 78, 0.4);
        }

        .btn-outline-primary {
            border: 2px solid #F6C84E;
            color: #F6C84E;
            font-weight: 600;
            border-radius: 10px;
            padding: 0.75rem 1.5rem;
            transition: all 0.3s ease;
        }

        .btn-outline-primary:hover {
            background: #F6C84E;
            color: #000;
            transform: translateY(-2px);
        }

        .text-readable {
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .text-muted-readable {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #F6C84E 0%, #f4b942 100%);
            border-radius: 4px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border-left: 4px solid #F6C84E;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            color: #000;
            font-weight: bold;
        }

        .activity-icon.success { background: #28a745; }
        .activity-icon.info { background: #17a2b8; }
        .activity-icon.warning { background: #ffc107; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container inner">
            <a class="brand" href="index.html">
                <img loading="lazy" decoding="async" src="assets/logo.png" alt="Garcia Builder">
                <span class="title-gradient">Garcia Builder</span>
            </a>

            <nav class="nav">
                <a href="index.html">Home</a>
                <a href="about.html">About</a>
                <a href="transformations.html">Transformations</a>
                <a href="testimonials.html">Testimonials</a>
                <a href="pricing.html">Pricing</a>
                <a href="faq.html">FAQ</a>
                <a href="contact.html">Contact</a>
                <a href="dashboard.html" class="active">Dashboard</a>
            </nav>

            <div id="auth-buttons"></div>

            <div class="lang">
                <select id="lang-select">
                    <option value="en">EN</option>
                    <option value="pt">PT</option>
                    <option value="es">ES</option>
                </select>
            </div>
        </div>
    </nav>

    <!-- Main Dashboard -->
    <div class="dashboard-container">
        <div class="container">
            <!-- Welcome Header -->
            <div class="dashboard-header">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="title-gradient mb-2">
                            <i class="fas fa-tachometer-alt me-2"></i>
                            Dashboard
                        </h1>
                        <p class="text-readable mb-1">
                            Welcome back, <span class="fw-bold text-warning" id="userName">Loading...</span> 👋
                        </p>
                        <p class="text-muted-readable small mb-0">
                            <i class="fas fa-clock me-1"></i>
                            Last activity: <span id="lastActivity">Today</span>
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="d-flex align-items-center justify-content-end">
                            <div class="me-3 text-end">
                                <div class="fw-bold text-readable" id="userNameHeader">Loading...</div>
                                <small class="text-muted-readable" id="userEmail">...</small>
                                <div class="mt-1">
                                    <span class="badge bg-success">
                                        <i class="fas fa-circle me-1"></i>Online
                                    </span>
                                </div>
                            </div>
                            <img id="header-avatar" class="rounded-circle border border-2 border-warning" 
                                 style="width: 56px; height: 56px; object-fit: cover; cursor: pointer;"
                                 src="https://ui-avatars.com/api/?name=User&background=F6C84E&color=000&size=56" 
                                 alt="User Avatar" onclick="scrollToProfile()">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stats-card text-center">
                        <div class="mb-3">
                            <i class="fas fa-calendar-alt text-primary" style="font-size: 2.5rem;"></i>
                        </div>
                        <h5 class="text-readable">Active Days</h5>
                        <h2 class="fw-bold text-primary mb-1">7</h2>
                        <small class="text-muted-readable">This week</small>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stats-card text-center">
                        <div class="mb-3">
                            <i class="fas fa-dumbbell text-success" style="font-size: 2.5rem;"></i>
                        </div>
                        <h5 class="text-readable">Total Workouts</h5>
                        <h2 class="fw-bold text-success mb-1">12</h2>
                        <small class="text-muted-readable">This month</small>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stats-card text-center">
                        <div class="mb-3">
                            <i class="fas fa-chart-line text-warning" style="font-size: 2.5rem;"></i>
                        </div>
                        <h5 class="text-readable">Progress</h5>
                        <h2 class="fw-bold text-warning mb-1">85%</h2>
                        <small class="text-muted-readable">Monthly goal</small>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stats-card text-center">
                        <div class="mb-3">
                            <i class="fas fa-trophy text-danger" style="font-size: 2.5rem;"></i>
                        </div>
                        <h5 class="text-readable">Current Streak</h5>
                        <h2 class="fw-bold text-danger mb-1">14</h2>
                        <small class="text-muted-readable">Days in a row</small>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Main Content -->
                <div class="col-lg-8">
                    <!-- Workout Plan -->
                    <div class="main-card">
                        <h5 class="d-flex align-items-center mb-4 text-readable">
                            <i class="fas fa-lock me-2 text-warning"></i>
                            Personalized Workout Plan
                        </h5>
                        <p class="text-muted-readable mb-4">
                            This week we focus on chest and back with progressive intensity.
                        </p>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <h6 class="text-readable mb-3">
                                    <i class="fas fa-calendar-week me-2"></i>Current Week
                                </h6>
                                <div class="activity-item">
                                    <div class="activity-icon success">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold text-readable">Monday - Push Day</div>
                                        <small class="text-muted-readable">Chest & Shoulders</small>
                                    </div>
                                </div>
                                <div class="activity-item">
                                    <div class="activity-icon success">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold text-readable">Tuesday - Pull Day</div>
                                        <small class="text-muted-readable">Back & Biceps</small>
                                    </div>
                                </div>
                                <div class="activity-item">
                                    <div class="activity-icon warning">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold text-readable">Thursday - Legs</div>
                                        <small class="text-muted-readable">Today's workout</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <h6 class="text-readable mb-3">
                                    <i class="fas fa-chart-bar me-2"></i>Progress Metrics
                                </h6>
                                <div class="info-row">
                                    <div class="info-label">Bench Press:</div>
                                    <div class="info-value">80kg → 85kg</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-label">Deadlift:</div>
                                    <div class="info-value">120kg → 125kg</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-label">Squat:</div>
                                    <div class="info-value">100kg → 105kg</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-label">Total Volume:</div>
                                    <div class="info-value text-success">+12%</div>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex gap-2 mt-4">
                            <button class="btn btn-primary">
                                <i class="fas fa-play me-2"></i>Start Workout
                            </button>
                            <button class="btn btn-outline-primary">
                                <i class="fas fa-download me-2"></i>Download PDF
                            </button>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="main-card">
                        <h5 class="text-readable mb-4">
                            <i class="fas fa-clock me-2"></i>Recent Activity
                        </h5>
                        
                        <div class="activity-item">
                            <div class="activity-icon success">
                                <i class="fas fa-dumbbell"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="fw-bold text-readable">Workout Completed</div>
                                <small class="text-muted-readable">Push Day - Chest</small>
                                <div class="text-muted-readable small">Today, 2:30 PM</div>
                            </div>
                        </div>

                        <div class="activity-item">
                            <div class="activity-icon info">
                                <i class="fas fa-weight"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="fw-bold text-readable">Weight Updated</div>
                                <small class="text-muted-readable">75.2kg (-0.8kg)</small>
                                <div class="text-muted-readable small">Yesterday, 9:00 AM</div>
                            </div>
                        </div>

                        <div class="activity-item">
                            <div class="activity-icon warning">
                                <i class="fas fa-camera"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="fw-bold text-readable">Progress Photo Uploaded</div>
                                <small class="text-muted-readable">Week 12 comparison</small>
                                <div class="text-muted-readable small">3 days ago</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Sidebar -->
                <div class="col-lg-4">
                    <div class="profile-card" id="profile-section">
                        <!-- Avatar Section -->
                        <div class="avatar-section">
                            <div class="avatar-container">
                                <img id="profile-avatar" class="main-avatar" 
                                     src="https://ui-avatars.com/api/?name=User&background=F6C84E&color=000&size=120" 
                                     alt="Profile Picture">
                                <button class="avatar-edit-btn" onclick="changeProfilePicture()">
                                    <i class="fas fa-camera"></i>
                                </button>
                            </div>
                            <h5 class="text-readable mt-3 mb-1" id="profile-display-name">Loading...</h5>
                            <p class="text-muted-readable mb-0" id="profile-display-email">...</p>
                            <div class="mt-2">
                                <span class="badge bg-success">
                                    <i class="fas fa-check-circle me-1"></i>Verified Account
                                </span>
                            </div>
                        </div>

                        <!-- Profile Information -->
                        <div class="mb-4">
                            <h6 class="text-readable mb-3">
                                <i class="fas fa-user me-2"></i>Profile Information
                            </h6>
                            
                            <div class="info-row">
                                <i class="fas fa-user info-icon"></i>
                                <div class="info-label">Name:</div>
                                <div class="info-value" id="profile-name">Loading...</div>
                            </div>
                            
                            <div class="info-row">
                                <i class="fas fa-envelope info-icon"></i>
                                <div class="info-label">Email:</div>
                                <div class="info-value" id="profile-email">Loading...</div>
                            </div>
                            
                            <div class="info-row">
                                <i class="fas fa-phone info-icon"></i>
                                <div class="info-label">Phone:</div>
                                <div class="info-value" id="profile-phone">Not provided</div>
                                <button class="btn btn-link btn-sm p-0 ms-2" onclick="editPhone()">
                                    <i class="fas fa-edit text-warning"></i>
                                </button>
                            </div>
                            
                            <div class="info-row">
                                <i class="fas fa-birthday-cake info-icon"></i>
                                <div class="info-label">Birthday:</div>
                                <div class="info-value" id="profile-dob">Not provided</div>
                                <button class="btn btn-link btn-sm p-0 ms-2" onclick="editBirthdate()">
                                    <i class="fas fa-edit text-warning"></i>
                                </button>
                            </div>
                            
                            <div class="info-row">
                                <i class="fas fa-calendar-plus info-icon"></i>
                                <div class="info-label">Member since:</div>
                                <div class="info-value" id="profile-created">...</div>
                            </div>
                        </div>

                        <!-- Profile Actions -->
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" onclick="editProfile()">
                                <i class="fas fa-edit me-2"></i>Edit Full Profile
                            </button>
                            <button class="btn btn-outline-primary" onclick="downloadProfile()">
                                <i class="fas fa-download me-2"></i>Export Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Edit Modal -->
    <div class="modal fade" id="profileEditModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="background: rgba(15, 15, 15, 0.95); border: 1px solid rgba(246, 200, 78, 0.3); color: #fff;">
                <div class="modal-header border-0">
                    <h5 class="modal-title text-warning">
                        <i class="fas fa-user-edit me-2"></i>Edit Profile
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4 text-center mb-4">
                            <img id="modal-avatar" class="rounded-circle border border-3 border-warning mb-3" 
                                 style="width: 120px; height: 120px; object-fit: cover;"
                                 src="https://ui-avatars.com/api/?name=User&background=F6C84E&color=000&size=120" 
                                 alt="Profile Picture">
                            <div>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="changeModalPicture()">
                                    <i class="fas fa-camera me-1"></i>Change Photo
                                </button>
                            </div>
                        </div>
                        
                        <div class="col-md-8">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label text-readable">
                                        <i class="fas fa-user me-1 text-warning"></i>Full Name
                                    </label>
                                    <input type="text" class="form-control" id="modal-name" placeholder="Enter your full name">
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label text-readable">
                                        <i class="fas fa-envelope me-1 text-warning"></i>Email
                                    </label>
                                    <input type="email" class="form-control" id="modal-email" readonly>
                                    <small class="text-muted-readable">Email cannot be changed</small>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label text-readable">
                                        <i class="fas fa-phone me-1 text-warning"></i>Phone
                                    </label>
                                    <input type="tel" class="form-control" id="modal-phone" placeholder="(11) 99999-9999">
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label text-readable">
                                        <i class="fas fa-birthday-cake me-1 text-warning"></i>Date of Birth
                                    </label>
                                    <input type="date" class="form-control" id="modal-dob">
                                </div>
                                
                                <div class="col-12 mb-3">
                                    <label class="form-label text-readable">
                                        <i class="fas fa-map-marker-alt me-1 text-warning"></i>City
                                    </label>
                                    <input type="text" class="form-control" id="modal-city" placeholder="Your city">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveProfile()">
                        <i class="fas fa-save me-1"></i>Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase.js"></script>
    <script src="js/auth.js"></script>

    <script>
        // Dashboard authentication and functionality
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                console.log('🏠 Initializing Dashboard...');

                // Wait for Supabase with better error handling
                async function waitForSupabase() {
                    let attempts = 0;
                    const maxAttempts = 10;
                    
                    while (attempts < maxAttempts) {
                        if (window.supabase && !window.supabaseClient) {
                            window.supabaseClient = window.supabase.createClient(
                                window.SUPABASE_URL, 
                                window.SUPABASE_ANON_KEY
                            );
                        }
                        
                        if (window.supabaseClient) {
                            return true;
                        }
                        
                        attempts++;
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                    
                    return false;
                }
                
                const supabaseReady = await waitForSupabase();
                if (!supabaseReady) {
                    showError('Authentication system failed to load. Please refresh the page.');
                    return;
                }

                // Check authentication
                const { data, error } = await window.supabaseClient.auth.getUser();
                
                if (error || !data.user) {
                    console.log('❌ User not authenticated, redirecting...');
                    window.location.href = 'login.html?redirect=' + encodeURIComponent(window.location.pathname);
                    return;
                }

                const user = data.user;
                console.log('✅ User authenticated:', user.email);

                // Load profile data
                const { data: profile, error: profileError } = await window.supabaseClient
                    .from('user_profiles')
                    .select('*')
                    .eq('user_id', user.id)
                    .single();

                // Update UI
                updateProfileElements(user, profile);

                // Setup auth buttons
                setupAuthButtons(user, profile);

                console.log('✅ Dashboard loaded successfully!');

            } catch (error) {
                console.error('Dashboard error:', error);
                showError('Failed to load dashboard. Please try again.');
            }
        });

        function updateProfileElements(user, profile) {
            const displayName = (profile && profile.full_name) ? profile.full_name : user.email.split('@')[0];
            
            // Update all name elements
            document.getElementById('userName').textContent = displayName;
            document.getElementById('userNameHeader').textContent = displayName;
            document.getElementById('profile-display-name').textContent = displayName;
            document.getElementById('profile-name').textContent = displayName;
            
            // Update email elements
            document.getElementById('userEmail').textContent = user.email;
            document.getElementById('profile-display-email').textContent = user.email;
            document.getElementById('profile-email').textContent = user.email;
            
            // Update avatars
            const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(displayName)}&background=F6C84E&color=000&size=120`;
            document.getElementById('header-avatar').src = avatarUrl;
            document.getElementById('profile-avatar').src = avatarUrl;
            
            // Update phone
            const phoneElement = document.getElementById('profile-phone');
            if (profile && profile.phone) {
                phoneElement.textContent = profile.phone;
                phoneElement.classList.remove('text-muted-readable');
                phoneElement.classList.add('text-readable');
            }
            
            // Update birth date
            const dobElement = document.getElementById('profile-dob');
            if (profile && profile.date_of_birth) {
                const date = new Date(profile.date_of_birth);
                dobElement.textContent = date.toLocaleDateString('en-US');
                dobElement.classList.remove('text-muted-readable');
                dobElement.classList.add('text-readable');
            }
            
            // Update member since
            if (user.created_at) {
                const created = new Date(user.created_at);
                document.getElementById('profile-created').textContent = created.toLocaleDateString('en-US');
            }
        }

        function setupAuthButtons(user, profile) {
            const authButtons = document.getElementById('auth-buttons');
            const displayName = (profile && profile.full_name) ? profile.full_name : user.email.split('@')[0];
            
            authButtons.innerHTML = `
                <div class="dropdown">
                    <button class="btn btn-outline-warning dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user me-1"></i> ${displayName}
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="dashboard.html">
                            <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="handleLogout()">
                            <i class="fas fa-sign-out-alt me-2"></i>Logout
                        </a></li>
                    </ul>
                </div>
            `;
        }

        // Profile management functions
        function changeProfilePicture() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('profile-avatar').src = e.target.result;
                        document.getElementById('header-avatar').src = e.target.result;
                        showToast('Profile picture updated!', 'success');
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        function editPhone() {
            const currentPhone = document.getElementById('profile-phone').textContent;
            const newPhone = prompt('Enter your phone number:', currentPhone === 'Not provided' ? '' : currentPhone);
            
            if (newPhone !== null) {
                const phoneEl = document.getElementById('profile-phone');
                phoneEl.textContent = newPhone || 'Not provided';
                phoneEl.classList.toggle('text-muted-readable', !newPhone);
                phoneEl.classList.toggle('text-readable', !!newPhone);
                showToast('Phone number updated!', 'success');
            }
        }

        function editBirthdate() {
            const newDob = prompt('Enter your date of birth (MM/DD/YYYY):');
            
            if (newDob !== null && newDob.match(/^\d{2}\/\d{2}\/\d{4}$/)) {
                const dobEl = document.getElementById('profile-dob');
                dobEl.textContent = newDob;
                dobEl.classList.remove('text-muted-readable');
                dobEl.classList.add('text-readable');
                showToast('Date of birth updated!', 'success');
            } else if (newDob !== null) {
                alert('Please use the format MM/DD/YYYY');
            }
        }

        function editProfile() {
            // Populate modal
            document.getElementById('modal-avatar').src = document.getElementById('profile-avatar').src;
            document.getElementById('modal-name').value = document.getElementById('profile-name').textContent;
            document.getElementById('modal-email').value = document.getElementById('profile-email').textContent;
            
            const phone = document.getElementById('profile-phone').textContent;
            document.getElementById('modal-phone').value = phone !== 'Not provided' ? phone : '';
            
            // Show modal
            new bootstrap.Modal(document.getElementById('profileEditModal')).show();
        }

        function changeModalPicture() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('modal-avatar').src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        function saveProfile() {
            const name = document.getElementById('modal-name').value;
            const phone = document.getElementById('modal-phone').value;
            const city = document.getElementById('modal-city').value;
            const dob = document.getElementById('modal-dob').value;
            
            // Update UI elements
            if (name) {
                document.getElementById('userName').textContent = name;
                document.getElementById('userNameHeader').textContent = name;
                document.getElementById('profile-display-name').textContent = name;
                document.getElementById('profile-name').textContent = name;
            }
            
            if (phone) {
                const phoneEl = document.getElementById('profile-phone');
                phoneEl.textContent = phone;
                phoneEl.classList.remove('text-muted-readable');
                phoneEl.classList.add('text-readable');
            }
            
            if (dob) {
                const dobEl = document.getElementById('profile-dob');
                const date = new Date(dob);
                dobEl.textContent = date.toLocaleDateString('en-US');
                dobEl.classList.remove('text-muted-readable');
                dobEl.classList.add('text-readable');
            }
            
            // Update avatars
            const newAvatar = document.getElementById('modal-avatar').src;
            document.getElementById('profile-avatar').src = newAvatar;
            document.getElementById('header-avatar').src = newAvatar;
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('profileEditModal')).hide();
            
            showToast('Profile updated successfully!', 'success');
        }

        function downloadProfile() {
            const profileData = {
                name: document.getElementById('profile-name').textContent,
                email: document.getElementById('profile-email').textContent,
                phone: document.getElementById('profile-phone').textContent,
                birthday: document.getElementById('profile-dob').textContent,
                member_since: document.getElementById('profile-created').textContent
            };
            
            const dataStr = JSON.stringify(profileData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'garcia_builder_profile.json';
            link.click();
            
            showToast('Profile data exported!', 'success');
        }

        function scrollToProfile() {
            document.getElementById('profile-section').scrollIntoView({ 
                behavior: 'smooth',
                block: 'center'
            });
        }

        async function handleLogout() {
            try {
                await window.supabaseClient.auth.signOut();
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = 'index.html';
            }
        }

        function showError(message) {
            document.body.innerHTML = `
                <div class="container mt-5 text-center">
                    <div class="alert alert-danger">
                        <h4><i class="fas fa-exclamation-triangle me-2"></i>Error</h4>
                        <p>${message}</p>
                        <button class="btn btn-primary" onclick="window.location.reload()">
                            <i class="fas fa-refresh me-2"></i>Try Again
                        </button>
                    </div>
                </div>
            `;
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgClass = type === 'success' ? 'alert-success' : 'alert-info';
            const icon = type === 'success' ? 'check' : 'info';
            
            toast.className = `alert ${bgClass} position-fixed`;
            toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            toast.innerHTML = `
                <i class="fas fa-${icon}-circle me-2"></i>
                ${message}
                <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) toast.remove();
            }, 4000);
        }

        // Update form controls styling
        document.addEventListener('DOMContentLoaded', function() {
            const style = document.createElement('style');
            style.textContent = `
                .form-control {
                    background: rgba(255, 255, 255, 0.08);
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    border-radius: 8px;
                    color: #fff;
                    padding: 0.75rem;
                }
                .form-control:focus {
                    background: rgba(255, 255, 255, 0.12);
                    border-color: #F6C84E;
                    box-shadow: 0 0 0 0.2rem rgba(246, 200, 78, 0.25);
                    color: #fff;
                }
                .form-control::placeholder {
                    color: rgba(255, 255, 255, 0.5);
                }
                .form-control[readonly] {
                    background: rgba(255, 255, 255, 0.05);
                    color: rgba(255, 255, 255, 0.7);
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>