<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Success - Garcia Builder</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/global.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        body {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #fff;
            min-height: 100vh;
        }

        .success-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem 0;
        }

        .success-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 22px;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 3rem;
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
        }

        .success-icon {
            font-size: 4rem;
            color: #28a745;
            margin-bottom: 1.5rem;
            animation: checkmark 0.8s ease-in-out;
        }

        @keyframes checkmark {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        .success-title {
            background: linear-gradient(135deg, #F6C84E, #FFD700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .loading-dots {
            display: inline-block;
        }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container inner">
            <a class="brand" href="index.html">
                <img loading="lazy" decoding="async" src="assets/logo.png">
                <span class="title-gradient">Garcia Builder</span>
            </a>
        </div>
    </nav>

    <div class="success-container">
        <div class="container">
            <div class="success-card">
                <div id="loading-state">
                    <i class="fas fa-spinner fa-spin success-icon"></i>
                    <h1 class="success-title">Verificando Pagamento<span class="loading-dots"></span></h1>
                    <p class="lead">Aguarde enquanto confirmamos seu pagamento...</p>
                </div>

                <div id="success-state" style="display: none;">
                    <i class="fas fa-check-circle success-icon"></i>
                    <h1 class="success-title" data-i18n="success.title">Pagamento Confirmado!</h1>
                    <p class="lead mb-4" data-i18n="success.subtitle">Obrigado por escolher o Garcia Builder. Sua jornada de transformação começou!</p>

                    <div class="payment-details mb-4" id="payment-details">
                        <!-- Detalhes do pagamento serão inseridos aqui -->
                    </div>

                    <div class="next-steps">
                        <h4 class="mb-3" data-i18n="success.next_steps.title">Próximos Passos:</h4>
                        <div class="row text-start">
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-start">
                                    <i class="fas fa-envelope text-primary me-3 mt-1"></i>
                                    <div>
                                        <h6 data-i18n="success.next_steps.email.title">Verifique seu Email</h6>
                                        <small class="text-muted" data-i18n="success.next_steps.email.desc">Enviamos instruções detalhadas para começar</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-start">
                                    <i class="fas fa-mobile-alt text-success me-3 mt-1"></i>
                                    <div>
                                        <h6 data-i18n="success.next_steps.app.title">Download do App</h6>
                                        <small class="text-muted" data-i18n="success.next_steps.app.desc">Baixe o Trainerize para acompanhar seus treinos</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-start">
                                    <i class="fas fa-whatsapp text-success me-3 mt-1"></i>
                                    <div>
                                        <h6 data-i18n="success.next_steps.whatsapp.title">WhatsApp</h6>
                                        <small class="text-muted" data-i18n="success.next_steps.whatsapp.desc">Você será adicionado ao grupo de suporte</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-start">
                                    <i class="fas fa-calendar-check text-warning me-3 mt-1"></i>
                                    <div>
                                        <h6 data-i18n="success.next_steps.schedule.title">Agendar Chamada</h6>
                                        <small class="text-muted" data-i18n="success.next_steps.schedule.desc">Vamos criar seu plano personalizado</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <a href="dashboard.html" class="btn btn-primary btn-lg me-3">
                            <i class="fas fa-tachometer-alt me-2"></i>
                            <span data-i18n="success.go_to_dashboard">Ir para Dashboard</span>
                        </a>
                        <a href="https://wa.me/447508497586?text=Hi%20Andre%21%20I%20just%20completed%20my%20payment%20and%20I%27m%20ready%20to%20start!"
                           target="_blank" class="btn btn-success btn-lg">
                            <i class="fab fa-whatsapp me-2"></i>
                            <span data-i18n="success.contact_coach">Falar com o Coach</span>
                        </a>
                    </div>
                </div>

                <div id="error-state" style="display: none;">
                    <i class="fas fa-exclamation-triangle text-warning success-icon"></i>
                    <h1 class="success-title">Erro na Verificação</h1>
                    <p class="lead mb-4">Houve um problema ao verificar seu pagamento. Entre em contato conosco.</p>

                    <div class="mt-4">
                        <a href="pricing.html" class="btn btn-outline-primary me-3">
                            <i class="fas fa-arrow-left me-2"></i>Voltar aos Planos
                        </a>
                        <a href="contact.html" class="btn btn-primary">
                            <i class="fas fa-envelope me-2"></i>Contatar Suporte
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script defer src="js/i18n-shim.js"></script>
    <script defer src="assets/i18n.js?v=20250926"></script>

    <script>
        // Verificar status do pagamento
        document.addEventListener('DOMContentLoaded', async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('session_id');

            if (!sessionId) {
                showError('Session ID não encontrado');
                return;
            }

            try {
                // Verificar status do pagamento
                const response = await fetch(`/api/payment-status/${sessionId}`);
                const data = await response.json();

                if (response.ok && data.status === 'paid') {
                    showSuccess(data);
                } else {
                    showError('Pagamento não confirmado');
                }
            } catch (error) {
                console.error('Erro ao verificar pagamento:', error);
                showError('Erro ao verificar pagamento');
            }
        });

        function showSuccess(paymentData) {
            document.getElementById('loading-state').style.display = 'none';
            document.getElementById('success-state').style.display = 'block';

            // Mostrar detalhes do pagamento
            if (paymentData.customer_email) {
                const detailsHtml = `
                    <div class="alert alert-success">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Email:</strong> ${paymentData.customer_email}
                        ${paymentData.subscription_id ? `<br><strong>ID da Assinatura:</strong> ${paymentData.subscription_id}` : ''}
                    </div>
                `;
                document.getElementById('payment-details').innerHTML = detailsHtml;
            }
        }

        function showError(message) {
            document.getElementById('loading-state').style.display = 'none';
            document.getElementById('error-state').style.display = 'block';
            console.error('Payment verification error:', message);
        }
    </script>
</body>
</html>
