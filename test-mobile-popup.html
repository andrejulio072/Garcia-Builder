<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Mobile - Exit Intent Popup</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/newsletter.css">
    <style>
        body {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #fff;
            min-height: 300vh; /* Extra height for scroll testing */
            padding: 20px;
        }

        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .test-section {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(246, 200, 78, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .test-button {
            background: linear-gradient(135deg, #F6C84E, #f39c12);
            border: none;
            border-radius: 12px;
            color: #000;
            font-weight: 700;
            padding: 15px 20px;
            margin: 10px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .test-button:hover {
            transform: translateY(-2px);
        }

        .device-info {
            background: rgba(40, 167, 69, 0.1);
            border: 1px solid rgba(40, 167, 69, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .scroll-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(246, 200, 78, 0.9);
            color: #000;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            z-index: 5000;
        }

        .content-section {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px dashed rgba(246, 200, 78, 0.3);
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="scroll-indicator" id="scrollIndicator">
        Scroll: 0%
    </div>

    <div class="test-container">
        <h1><i class="fas fa-mobile-alt"></i> Teste Mobile - Exit Intent Popup</h1>

        <div class="test-section">
            <h3><i class="fas fa-info-circle"></i> Informa√ß√µes do Dispositivo</h3>
            <div class="device-info" id="deviceInfo">
                Carregando informa√ß√µes...
            </div>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-play"></i> Testes Manuais</h3>
            <p>Clique nos bot√µes abaixo para testar diferentes cen√°rios:</p>

            <button class="test-button" onclick="triggerExitIntent()">
                <i class="fas fa-cursor"></i> Simular Exit Intent
            </button>

            <button class="test-button" onclick="triggerLeadMagnet()">
                <i class="fas fa-magnet"></i> Trigger Lead Magnet
            </button>

            <button class="test-button" onclick="clearSession()">
                <i class="fas fa-trash"></i> Limpar Sess√£o
            </button>

            <button class="test-button" onclick="checkPopupCSS()">
                <i class="fas fa-code"></i> Verificar CSS
            </button>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-scroll"></i> Teste de Scroll (Mobile)</h3>
            <p>Role para baixo para ativar o popup autom√°tico em dispositivos m√≥veis.</p>
            <p><strong>Trigger:</strong> 60% da p√°gina + 3 segundos de delay</p>
            <div id="scrollProgress"></div>
        </div>

        <div class="content-section">
            <h2>üì± Se√ß√£o 1 - Continue rolando...</h2>
        </div>

        <div class="content-section">
            <h2>üì± Se√ß√£o 2 - Quase l√°...</h2>
        </div>

        <div class="content-section">
            <h2>üì± Se√ß√£o 3 - Popup deve aparecer aqui!</h2>
        </div>

        <div class="content-section">
            <h2>üì± Se√ß√£o 4 - Final do teste</h2>
        </div>
    </div>

    <!-- Newsletter System -->
    <script>
        // Mock Supabase for testing
        window.supabaseClient = {
            from: () => ({
                insert: () => Promise.resolve({ error: null })
            })
        };
    </script>
    <script src="js/newsletter-manager.js"></script>

    <script>
        // Device information
        function updateDeviceInfo() {
            const info = {
                'Largura da Tela': window.innerWidth + 'px',
                'Altura da Tela': window.innerHeight + 'px',
                'Tipo de Dispositivo': window.innerWidth <= 768 ? 'Mobile/Tablet' : 'Desktop',
                'User Agent': navigator.userAgent.includes('Mobile') ? 'Mobile' : 'Desktop',
                'Touch Support': 'ontouchstart' in window ? 'Sim' : 'N√£o',
                'Pixel Ratio': window.devicePixelRatio || 1
            };

            document.getElementById('deviceInfo').innerHTML = Object.entries(info)
                .map(([key, value]) => `<strong>${key}:</strong> ${value}`)
                .join('<br>');
        }

        // Scroll progress
        function updateScrollProgress() {
            const scrollPercent = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100);
            document.getElementById('scrollIndicator').textContent = `Scroll: ${scrollPercent}%`;

            if (scrollPercent >= 60) {
                document.getElementById('scrollProgress').innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>60%+ atingido!</strong> Em mobile, popup deve aparecer em 3 segundos.
                    </div>
                `;
            }
        }

        // Test functions
        function triggerExitIntent() {
            // Clear session first
            sessionStorage.removeItem('gb_exit_intent_shown_session');

            // Force trigger exit intent
            if (window.GarciaNewsletterSystem && window.GarciaNewsletterSystem.init) {
                // Simulate mouse leave event
                const event = new MouseEvent('mouseleave', {
                    clientY: -10,
                    bubbles: true
                });
                document.dispatchEvent(event);
            }
        }

        function triggerLeadMagnet() {
            // Clear session
            sessionStorage.removeItem('gb_exit_intent_shown_session');

            // Create temporary trigger
            const trigger = document.createElement('a');
            trigger.setAttribute('data-open-lead-magnet', 'true');
            trigger.click();
        }

        function clearSession() {
            sessionStorage.clear();
            localStorage.removeItem('garcia_leads');
            localStorage.removeItem('garcia_newsletter_subscribers');
            alert('Sess√£o limpa! Teste novamente.');
        }

        function checkPopupCSS() {
            const styles = [];
            const rules = [
                '.exit-intent-overlay',
                '.exit-intent-popup',
                '.exit-intent-content',
                '.exit-intent-form'
            ];

            rules.forEach(rule => {
                const element = document.querySelector(rule);
                if (element) {
                    const computed = window.getComputedStyle(element);
                    styles.push(`${rule}: Existe e est√° estilizado`);
                } else {
                    styles.push(`${rule}: N√£o encontrado no DOM`);
                }
            });

            alert('CSS Check:\n' + styles.join('\n'));
        }

        // Event listeners
        window.addEventListener('scroll', updateScrollProgress);
        window.addEventListener('resize', updateDeviceInfo);

        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            updateDeviceInfo();
            updateScrollProgress();

            // Override console.log for mobile debugging
            const originalLog = console.log;
            console.log = function(...args) {
                originalLog.apply(console, args);
                // Optionally show logs on screen for mobile debugging
                if (window.innerWidth <= 768) {
                    const logDiv = document.getElementById('mobileLog');
                    if (logDiv) {
                        logDiv.innerHTML += args.join(' ') + '<br>';
                        logDiv.scrollTop = logDiv.scrollHeight;
                    }
                }
            };
        });

        // Add mobile debug log area
        document.addEventListener('DOMContentLoaded', () => {
            if (window.innerWidth <= 768) {
                const logArea = document.createElement('div');
                logArea.id = 'mobileLog';
                logArea.style.cssText = `
                    position: fixed;
                    bottom: 10px;
                    left: 10px;
                    right: 10px;
                    height: 100px;
                    background: rgba(0,0,0,0.9);
                    color: #00ff00;
                    font-family: monospace;
                    font-size: 12px;
                    padding: 10px;
                    border-radius: 5px;
                    overflow-y: auto;
                    z-index: 9998;
                `;
                document.body.appendChild(logArea);
            }
        });
    </script>
</body>
</html>
