<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificar Dados - Garcia Builder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-dark text-white">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card bg-secondary">
                    <div class="card-header">
                        <h3 class="text-center text-warning">📊 Verificar Dados Salvos</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5 class="text-warning">🎯 Leads Capturados:</h5>
                                <div id="leadsData" class="bg-dark p-3 rounded">
                                    <p class="text-muted">Carregando...</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h5 class="text-warning">📧 Newsletter Subscribers:</h5>
                                <div id="subscribersData" class="bg-dark p-3 rounded">
                                    <p class="text-muted">Carregando...</p>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 text-center">
                            <button onclick="loadData()" class="btn btn-warning">
                                🔄 Recarregar Dados
                            </button>
                            <a href="test-newsletter.html" class="btn btn-primary">
                                🧪 Voltar ao Teste
                            </a>
                            <a href="admin-dashboard.html" class="btn btn-info">
                                📈 Admin Dashboard
                            </a>
                        </div>

                        <div class="mt-4">
                            <h6 class="text-warning">🔧 Status do Sistema:</h6>
                            <div id="systemStatus" class="bg-dark p-3 rounded">
                                <p class="text-muted">Verificando...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.js"></script>
    <script src="js/supabase-config.js"></script>

    <script>
        async function loadData() {
            const leadsDiv = document.getElementById('leadsData');
            const subscribersDiv = document.getElementById('subscribersData');
            const statusDiv = document.getElementById('systemStatus');

            // Check system status
            let statusHTML = '';
            if (window.supabaseClient) {
                statusHTML += '<p class="text-success">✅ Supabase: Conectado</p>';

                try {
                    // Test Supabase connection
                    const { data, error } = await window.supabaseClient
                        .from('leads')
                        .select('count', { count: 'exact', head: true });

                    if (error) {
                        statusHTML += `<p class="text-danger">❌ Erro Supabase: ${error.message}</p>`;
                    } else {
                        statusHTML += '<p class="text-success">✅ Tabelas: Funcionando</p>';
                    }
                } catch (err) {
                    statusHTML += `<p class="text-danger">❌ Erro de conexão: ${err.message}</p>`;
                }
            } else {
                statusHTML += '<p class="text-warning">⚠️ Supabase: Usando localStorage</p>';
            }
            statusDiv.innerHTML = statusHTML;

            // Load leads data
            try {
                let leads = [];
                if (window.supabaseClient) {
                    const { data, error } = await window.supabaseClient
                        .from('leads')
                        .select('*')
                        .order('created_at', { ascending: false });

                    if (!error) {
                        leads = data || [];
                    }
                } else {
                    leads = JSON.parse(localStorage.getItem('garcia_leads') || '[]');
                }

                if (leads.length > 0) {
                    leadsDiv.innerHTML = leads.map((lead, index) => `
                        <div class="border-bottom pb-2 mb-2">
                            <strong>${index + 1}. ${lead.name || 'Sem nome'}</strong><br>
                            <small class="text-muted">
                                📧 ${lead.email}<br>
                                🎯 ${lead.goal || 'N/A'}<br>
                                📍 ${lead.source || 'N/A'}<br>
                                📅 ${new Date(lead.created_at || lead.timestamp).toLocaleString('pt-BR')}
                            </small>
                        </div>
                    `).join('');
                } else {
                    leadsDiv.innerHTML = '<p class="text-muted">Nenhum lead encontrado</p>';
                }
            } catch (error) {
                leadsDiv.innerHTML = `<p class="text-danger">Erro: ${error.message}</p>`;
            }

            // Load subscribers data
            try {
                let subscribers = [];
                if (window.supabaseClient) {
                    const { data, error } = await window.supabaseClient
                        .from('newsletter_subscribers')
                        .select('*')
                        .order('created_at', { ascending: false });

                    if (!error) {
                        subscribers = data || [];
                    }
                } else {
                    subscribers = JSON.parse(localStorage.getItem('garcia_newsletter_subscribers') || '[]');
                }

                if (subscribers.length > 0) {
                    subscribersDiv.innerHTML = subscribers.map((sub, index) => `
                        <div class="border-bottom pb-2 mb-2">
                            <strong>${index + 1}. ${sub.name || 'Sem nome'}</strong><br>
                            <small class="text-muted">
                                📧 ${sub.email}<br>
                                📍 ${sub.source || 'N/A'}<br>
                                ✅ ${sub.status || 'subscribed'}<br>
                                📅 ${new Date(sub.created_at || sub.timestamp).toLocaleString('pt-BR')}
                            </small>
                        </div>
                    `).join('');
                } else {
                    subscribersDiv.innerHTML = '<p class="text-muted">Nenhum subscriber encontrado</p>';
                }
            } catch (error) {
                subscribersDiv.innerHTML = `<p class="text-danger">Erro: ${error.message}</p>`;
            }
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(loadData, 1000); // Wait for supabase to initialize
        });
    </script>
</body>
</html>
